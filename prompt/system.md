# Uma Crown Simulator - ã‚·ã‚¹ãƒ†ãƒ å…¨å®¹

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚“ã  AI ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨å®¹ã‚’æŠŠæ¡ã—ã€ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãƒ»è³ªå•å¯¾å¿œãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã‚¦ãƒå¨˜è‚²æˆã‚²ãƒ¼ãƒ ã® **å…¨å† ç§°å·å–å¾—** ã‚’æ”¯æ´ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã€‚
è‚²æˆã—ãŸã‚¦ãƒå¨˜ã®é©æ€§ãƒ»å› å­æƒ…å ±ã‚’ç™»éŒ²ã—ã€å…¨å† ç§°å·ã¾ã§ã«å¿…è¦ãªæ®‹ãƒ¬ãƒ¼ã‚¹ã¨å‡ºèµ°ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç…§åˆãƒ»è¨ˆç®—ã™ã‚‹ã€‚

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| å±¤ | æŠ€è¡“ |
|---|---|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Angular (standalone ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ) + Tailwind CSS v4 |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | NestJS (ESM) + Prisma ORM |
| DB | PostgreSQL |
| èªè¨¼ | AWS Cognito (amazon-cognito-identity-js) |
| ã‚¤ãƒ³ãƒ•ãƒ© | Kubernetes (ãƒ­ãƒ¼ã‚«ãƒ«: Docker Desktop k8s) |
| å…±æœ‰å‹ | `shared/` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯å…±é€šã®å‹å®šç¾©ï¼‰ |

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
uma-crown-simulator/
â”œâ”€â”€ frontend/              # Angular ã‚¢ãƒ—ãƒª
â”‚   â”œâ”€â”€ src/app/
â”‚   â”‚   â”œâ”€â”€ app.ts                          # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆç”»é¢åˆ‡ã‚Šæ›¿ãˆï¼‰
â”‚   â”‚   â”œâ”€â”€ app.config.ts                   # ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šãƒ»HTTP ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ç™»éŒ²
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts         # Cognito èªè¨¼ï¼ˆlogin/logout/signUp/confirmSignUpï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ navigation.service.ts   # SPA ç”»é¢é·ç§»ç®¡ç†ï¼ˆViewState signalï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ character.service.ts    # ã‚¦ãƒå¨˜ API å‘¼ã³å‡ºã—
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ race.service.ts         # ãƒ¬ãƒ¼ã‚¹ API å‘¼ã³å‡ºã—
â”‚   â”‚   â”‚   â”œâ”€â”€ guards/auth.guard.ts        # ç¾åœ¨æœªä½¿ç”¨ï¼ˆNavigationService ã§åˆ¶å¾¡ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ interceptors/auth.interceptor.ts  # JWT ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ Authorization ãƒ˜ãƒƒãƒ€ãƒ¼ã«ä»˜ä¸
â”‚   â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”‚   â”œâ”€â”€ landing/landing.ts          # LPï¼ˆåˆæœŸç”»é¢ãƒ»æ©Ÿèƒ½èª¬æ˜ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/login.ts          # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register/register.ts   # ä¼šå“¡ç™»éŒ²ç”»é¢ï¼ˆ2ã‚¹ãƒ†ãƒƒãƒ—: ç™»éŒ² â†’ ç¢ºèªã‚³ãƒ¼ãƒ‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ character-list/             # ç™»éŒ²æ¸ˆã¿ã‚¦ãƒå¨˜ä¸€è¦§
â”‚   â”‚   â”‚   â”œâ”€â”€ character-regist/           # ã‚¦ãƒå¨˜æƒ…å ±ç™»éŒ²
â”‚   â”‚   â”‚   â”œâ”€â”€ race-list/                  # ãƒ¬ãƒ¼ã‚¹ä¸€è¦§
â”‚   â”‚   â”‚   â””â”€â”€ remaining-race/             # æ®‹ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ãƒ»å‡ºèµ°ãƒ‘ã‚¿ãƒ¼ãƒ³è¨ˆç®—
â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”‚       â””â”€â”€ components/
â”‚   â”‚           â”œâ”€â”€ sidebar/sidebar.ts      # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚µã‚¤ãƒ‰ãƒãƒ¼
â”‚   â”‚           â””â”€â”€ toast/                  # ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
â”‚   â””â”€â”€ public/image/
â”‚       â”œâ”€â”€ backgroundFile/                 # å„ç”»é¢ã®èƒŒæ™¯ç”»åƒ
â”‚       â””â”€â”€ SidebarTab/                     # ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¿ãƒ–ã®èƒŒæ™¯ç”»åƒ
â”œâ”€â”€ backend/               # NestJS ã‚¢ãƒ—ãƒª
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ app.module.ts                   # ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ« AuthGuard è¨­å®šï¼‰
â”‚       â”œâ”€â”€ auth/                           # èªè¨¼é–¢é€£ï¼ˆCognito ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ï¼‰
â”‚       â”œâ”€â”€ umamusume/                      # ã‚¦ãƒå¨˜ CRUD
â”‚       â”œâ”€â”€ race/
â”‚       â”‚   â”œâ”€â”€ race.controller.ts          # ãƒ¬ãƒ¼ã‚¹ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ race.service.ts             # ãƒ¬ãƒ¼ã‚¹å–å¾—ãƒ»å‡ºèµ°ç™»éŒ²
â”‚       â”‚   â””â”€â”€ pattern/race-pattern.service.ts  # å…¨å† ç…§åˆãƒ»å‡ºèµ°ãƒ‘ã‚¿ãƒ¼ãƒ³è¨ˆç®—
â”‚       â”œâ”€â”€ seed/                           # åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥
â”‚       â””â”€â”€ common/
â”‚           â”œâ”€â”€ cognito/                    # Cognito JWT æ¤œè¨¼ã‚µãƒ¼ãƒ“ã‚¹
â”‚           â”œâ”€â”€ guards/auth.guard.ts        # ã‚°ãƒ­ãƒ¼ãƒãƒ«èªè¨¼ã‚¬ãƒ¼ãƒ‰ï¼ˆ@Public() ã§é™¤å¤–å¯ï¼‰
â”‚           â””â”€â”€ decorators/                 # @CurrentUser() / @Public()
â”œâ”€â”€ shared/                # ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯å…±é€šã®å‹å®šç¾©
â”œâ”€â”€ k8s/                   # Kubernetes ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â”œâ”€â”€ prompt/                # AI å‘ã‘ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé›†ï¼ˆã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
â””â”€â”€ script/                # é–‹ç™ºè£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ

### ç”»é¢é·ç§»ã®ä»•çµ„ã¿
- Angular Router **æœªä½¿ç”¨**ã€‚`NavigationService` ã® `currentView` signal ã§ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚
- `app.ts` ãŒ `@switch` ã§ `ViewState.page` ã«å¿œã˜ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã€‚

### ViewStateï¼ˆç”»é¢ä¸€è¦§ï¼‰
```typescript
type ViewState =
  | { page: 'landing' }               // LPï¼ˆåˆæœŸç”»é¢ï¼‰
  | { page: 'login' }                 // ãƒ­ã‚°ã‚¤ãƒ³
  | { page: 'register' }              // ä¼šå“¡ç™»éŒ²
  | { page: 'character-list' }        // ã‚¦ãƒå¨˜ä¸€è¦§
  | { page: 'character-regist' }      // ã‚¦ãƒå¨˜ç™»éŒ²
  | { page: 'race-list' }             // ãƒ¬ãƒ¼ã‚¹ä¸€è¦§
  | { page: 'remaining-race' }        // æ®‹ãƒ¬ãƒ¼ã‚¹ä¸€è¦§
  | { page: 'remaining-race-pattern'; umamusumeId: number }; // å‡ºèµ°ãƒ‘ã‚¿ãƒ¼ãƒ³
```

### èªè¨¼ãƒ•ãƒ­ãƒ¼
- å¸¸ã«ã‚µã‚¤ãƒ‰ãƒãƒ¼ + ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ã§ã‚‚ã‚¢ãƒ—ãƒªå…¨ä½“ãŒè¦‹ãˆã‚‹ï¼‰
- ã‚µã‚¤ãƒ‰ãƒãƒ¼: `requiresLogin: true` ã®é …ç›®ã¯æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + ğŸ”’
- ãƒ­ã‚°ã‚¤ãƒ³ / ä¼šå“¡ç™»éŒ² / ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ ãƒœã‚¿ãƒ³ã¯ã‚µã‚¤ãƒ‰ãƒãƒ¼ä¸‹éƒ¨ã«è¡¨ç¤º

### ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆtsconfig.jsonï¼‰
```
@core/*  â†’ src/app/core/*
@ui/*    â†’ src/app/shared/*
@shared/* â†’ ../shared/*ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã® shared/ï¼‰
@env     â†’ src/app/environments/environment
```

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­è¨ˆ

### èªè¨¼
- ã‚°ãƒ­ãƒ¼ãƒãƒ« `AuthGuard` ãŒå…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ Cognito JWT ã‚’æ¤œè¨¼
- `@Public()` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä»˜ã‘ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯èªè¨¼ä¸è¦
- `@CurrentUser()` ã§ Cognito ã® `sub`ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰ã‚’å–å¾—

### ä¸»è¦ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```
GET  /umamusumes                    # å…¨ã‚¦ãƒå¨˜ä¸€è¦§ï¼ˆèªè¨¼ä¸è¦ï¼‰
GET  /umamusumes/unregistered       # æœªç™»éŒ²ã‚¦ãƒå¨˜ä¸€è¦§
GET  /umamusumes/registered         # ç™»éŒ²æ¸ˆã¿ã‚¦ãƒå¨˜ä¸€è¦§
POST /umamusumes/registrations      # ã‚¦ãƒå¨˜ç™»éŒ²

GET  /races                         # ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ï¼ˆèªè¨¼ä¸è¦ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ã‚ã‚Šï¼‰
GET  /races/registration-targets    # ç™»éŒ²å¯¾è±¡ãƒ¬ãƒ¼ã‚¹ä¸€è¦§
GET  /races/remaining               # æ®‹ãƒ¬ãƒ¼ã‚¹ä¸€è¦§
GET  /races/remaining/search        # æ®‹ãƒ¬ãƒ¼ã‚¹æ¤œç´¢
POST /races/run                     # å‡ºèµ°ç™»éŒ²
POST /races/results                 # ãƒ¬ãƒ¼ã‚¹çµæœç™»éŒ²
POST /races/results/batch           # ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€æ‹¬ç™»éŒ²
GET  /races/patterns/:umamusumeId   # å‡ºèµ°ãƒ‘ã‚¿ãƒ¼ãƒ³å€™è£œå–å¾—
```

---

## DB ã‚¹ã‚­ãƒ¼ãƒï¼ˆä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

- `umamusume_table` â€” ã‚¦ãƒå¨˜ãƒã‚¹ã‚¿ï¼ˆåå‰ãƒ»é©æ€§æƒ…å ±ï¼‰
- `race_table` â€” ãƒ¬ãƒ¼ã‚¹ãƒã‚¹ã‚¿ï¼ˆãƒ¬ãƒ¼ã‚¹åãƒ»é¦¬å ´ãƒ»è·é›¢ãƒ»ãƒ©ãƒ³ã‚¯ãƒ»å„ã‚·ãƒŠãƒªã‚ªå¯¾å¿œãƒ•ãƒ©ã‚°ï¼‰
- `scenario_race_table` â€” ã‚¦ãƒå¨˜ã”ã¨ã®ã‚·ãƒŠãƒªã‚ªãƒ¬ãƒ¼ã‚¹å®šç¾©
- `regist_umamusume_table` â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã—ãŸã‚¦ãƒå¨˜
- `regist_umamusume_race_table` â€” ç™»éŒ²ã‚¦ãƒå¨˜ã®å‡ºèµ°æ¸ˆã¿ãƒ¬ãƒ¼ã‚¹

---

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- ã‚³ãƒ¡ãƒ³ãƒˆã¯ **æ—¥æœ¬èª**
- Angular: standalone ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»signal ãƒ™ãƒ¼ã‚¹ã®ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–
- NestJS: ESMï¼ˆ`.js` æ‹¡å¼µå­ä»˜ãã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰
- Tailwind: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ç›´æ›¸ãï¼ˆCSS ãƒ•ã‚¡ã‚¤ãƒ«åŸå‰‡ãªã—ï¼‰
- å‹ã¯ `shared/` ã«é›†ç´„ã€ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯ã§å…±æœ‰
- **JSDoc**: ã‚¯ãƒ©ã‚¹ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»å…¬é–‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã« `/** æ—¥æœ¬èªèª¬æ˜ */` ã‚’ä»˜ã‘ã‚‹
  - ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¯ `@param` / `@returns` ã‚¿ã‚°ã‚‚è¨˜è¼‰
  - å˜ç´”ãª getterãƒ»signal ã® computed ã¯çœç•¥å¯
